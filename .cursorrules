# Bologna Marathon - Sistema Modulare
# File di contesto per Cursor AI

## ğŸƒâ€â™‚ï¸ PROGETTO
Sistema modulare per il sito ufficiale della Bologna Marathon (bolognamarathon.run)
- **Tipo**: Sito sportivo modulare
- **Tecnologie**: PHP 8+, MySQL, CSS Variables, JavaScript vanilla
- **Architettura**: SSR (Server-Side Rendering) modulare
- **Path**: `http://localhost/sito_modulare/`

## ğŸš¨ REGOLE FONDAMENTALI

### âŒ ASSOLUTAMENTE VIETATO

#### 1. **NO HARDCODING**
- âŒ **MAI** valori hardcoded in PHP/HTML/JavaScript
- âŒ **MAI** colori hardcoded (usa CSS Variables)
- âŒ **MAI** URL hardcoded (usa variabili configurazione)
- âŒ **MAI** stringhe hardcoded (usa file di configurazione)
- âœ… **SEMPRE** usa configurazioni dinamiche, CSS Variables, costanti

#### 2. **NO CODICE SPAGHETTI**
- âŒ **MAI** CSS inline in PHP/HTML (es: `<div style="color: red">`)
- âŒ **MAI** JavaScript inline in PHP/HTML (es: `<button onclick="alert('hi')">`)
- âŒ **MAI** logica complessa in template PHP
- âŒ **MAI** SQL queries dirette in pagine (usa ModuleRenderer)
- âœ… **SEMPRE** separa: CSS in `.css`, JS in `.js`, logica in classi PHP

#### 3. **SEPARAZIONE DELLE RESPONSABILITÃ€**
```
âœ… STRUTTURA CORRETTA:
module.php     â†’ Template HTML + variabili PHP
module.css     â†’ TUTTI gli stili del modulo
module.js      â†’ TUTTA la logica JavaScript
module.json    â†’ Configurazione e manifest

âŒ STRUTTURA SBAGLIATA:
module.php     â†’ HTML + <style> + <script> + logica business
```

#### ğŸ“ Esempi Pratici

**âŒ CODICE SPAGHETTI (NON FARE MAI)**
```php
// âŒ hero.php - PESSIMO ESEMPIO
<div style="color: #23a8eb; padding: 2rem;">
    <style>
        .hero { background: red; }
        .hero:hover { background: blue; }
    </style>
    <script>
        function handleClick() { alert('ciao'); }
    </script>
    <button onclick="handleClick()">Click</button>
    <?php
        // âŒ Logica business nel template
        $db = new PDO(...);
        $results = $db->query("SELECT * FROM users WHERE id = " . $_GET['id']);
    ?>
</div>
```

**âœ… CODICE PULITO E MODULARE (FARE SEMPRE)**
```php
// âœ… hero.php - TEMPLATE PULITO
<?php
$moduleData = $renderer->getModuleData('hero', $config);
$title = $config['title'] ?? 'Default';
?>
<div class="hero hero--primary">
    <h1 class="hero__title"><?= htmlspecialchars($title) ?></h1>
    <button class="hero__button" data-action="cta">
        <?= htmlspecialchars($config['button_text']) ?>
    </button>
</div>

// âœ… hero.css - TUTTI GLI STILI
.hero {
    color: var(--primary);
    padding: var(--spacing-lg);
}
.hero:hover {
    background: var(--primary-light);
}

// âœ… hero.js - TUTTA LA LOGICA
class Hero {
    constructor(element) {
        this.element = element;
        this.bindEvents();
    }
    bindEvents() {
        this.element.addEventListener('click', this.handleClick.bind(this));
    }
    handleClick(event) {
        const target = event.target.closest('[data-action]');
        if (target) this.executeAction(target.dataset.action);
    }
}

// âœ… ModuleRenderer.php - LOGICA DATABASE
private function getHeroData($config) {
    $stmt = $this->db->prepare("SELECT * FROM heroes WHERE id = ?");
    $stmt->execute([$config['hero_id']]);
    return $stmt->fetch();
}
```

### âœ… REGOLE OBBLIGATORIE

#### CSS
- âœ… **File separati**: Ogni modulo ha il suo `.css`
- âœ… **CSS Variables**: Per colori, spacing, font
- âœ… **BEM Methodology**: Nomenclatura classi
- âœ… **No nesting**: Solo CSS classico esplicito
- âœ… **Mobile-first**: Responsive design

#### JavaScript
- âœ… **File separati**: Ogni modulo ha il suo `.js`
- âœ… **Classe modulare**: Pattern orientato a oggetti
- âœ… **Event delegation**: Performance ottimizzata
- âœ… **Auto-init**: Inizializzazione automatica
- âœ… **Cleanup**: Metodo `destroy()` per memory leak

#### PHP
- âœ… **Template puliti**: Solo HTML + variabili PHP
- âœ… **Logica nel core**: `ModuleRenderer.php` per business logic
- âœ… **Prepared statements**: SEMPRE per query database
- âœ… **Sanitizzazione**: `htmlspecialchars()` per output
- âœ… **Separazione**: Template â‰  Logica â‰  Database

## ğŸ“ STRUTTURA PROGETTO
```
sito_modulare/
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ css/core/          # CSS core (variables, reset, typography)
â”‚   â”œâ”€â”€ css/main.css       # Stili principali
â”‚   â”œâ”€â”€ js/core/           # JavaScript core
â”‚   â””â”€â”€ images/            # Immagini
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.php       # Configurazione database
â”œâ”€â”€ core/
â”‚   â””â”€â”€ ModuleRenderer.php # Sistema rendering moduli SSR
â”œâ”€â”€ modules/               # Moduli riutilizzabili
â”‚   â”œâ”€â”€ docs/             # Documentazione moduli
â”‚   â”œâ”€â”€ hero/             # Action Hero
â”‚   â”œâ”€â”€ results/          # Tabella risultati
â”‚   â”œâ”€â”€ menu/             # Menu navigazione
â”‚   â”œâ”€â”€ footer/           # Footer sito
â”‚   â””â”€â”€ text/             # Rich Text
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ docs/             # Documentazione database
â”‚   â”œâ”€â”€ schema.sql        # Schema database
â”‚   â””â”€â”€ test_data.sql     # Dati di test
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ docs/             # Documentazione admin
â”‚   â”œâ”€â”€ test-setup.php    # Setup database
â”‚   â””â”€â”€ page-builder.php  # Page Builder
â”œâ”€â”€ docs/                 # Documentazione sistema generale
â””â”€â”€ index.php            # Homepage principale
```

## ğŸ¨ SISTEMA CSS VARIABLES
**File principale**: `assets/css/core/variables.css`

### Colori Principali
- `--primary`: #23a8eb (Colore principale)
- `--secondary`: #dc335e (Colore secondario)
- `--accent`: #cbdf44 (Colore accent)
- `--info`: #5DADE2 (Colore info)
- `--success`: #00a8ff (Colore success)
- `--warning`: #F39C12 (Colore warning)
- `--error`: #E74C3C (Colore error)

### Font System
- `--font-primary`: 'Inter' (Font principale)
- `--font-display`: 'Bebas Neue' (Font display)
- `--font-accent`: 'Gloss And Bloom' (Font accent personalizzato)

### Scrollbar Personalizzate
- **File**: `assets/css/core/scrollbar.css`
- **FunzionalitÃ **: Scrollbar custom con temi dinamici, ottimizzata per performance
- **Temi**: Si adatta automaticamente ai colori di ogni gara
- **Performance**: Zero lag, ottimizzata con `contain`, `content-visibility`, no `will-change: scroll-position`
- **Guida**: `assets/css/core/SCROLLBAR-GUIDE.md`

### Personalizzazione
- **Override per pagina**: Tramite database (campo `css_variables`)
- **Override globali**: Modifica `variables.css`
- **Responsive**: Variabili per breakpoint
- **Font esterni**: Google Fonts + Font Awesome + Custom Fonts
- **Esempi**: `assets/css/examples/marathon-theme.css`
- **Documentazione**: `docs/COLORS_AND_FONTS.md`

## ğŸ§© MODULI DISPONIBILI
1. **actionHero** - Hero section con layout 2 colonne
2. **resultsTable** - Tabella risultati gara (ordinabile, filtri)
3. **menu** - Menu navigazione (sticky, mobile-friendly)
4. **footer** - Footer sito (4 colonne, social)
5. **richText** - Contenuti testuali ricchi
6. **gallery** - Galleria immagini (lightbox)

## ğŸ—„ï¸ DATABASE SCHEMA

### âš ï¸ IMPORTANTE: Verifica Struttura Tabelle
**SEMPRE consultare prima di scrivere SQL:**
- ğŸ“Š **Reference Completo**: `database/docs/SCHEMA-REFERENCE.md`
- ğŸ“„ **Schema Originale**: `database/schema.sql`
- ğŸ”„ **Migrazioni**: `database/docs/MIGRATIONS.md`

### Tabelle Principali
- `pages` - Pagine del sito
- `modules_registry` - Moduli disponibili (âš ï¸ NO description, ui_schema, slug, version)
- `page_modules` - Moduli assegnati alle pagine
- `race_results` - Risultati gara
- `races` - Gare
- `dynamic_content` - Contenuti dinamici

### Setup Database
1. **Setup automatico**: `admin/test-setup.php`
2. **Pannello admin**: `admin/admin.php`
3. **Debug**: `debug.php`
4. **Path corretto**: `http://localhost/sito_modulare/`

### Struttura `modules_registry` (Uso Frequente)
```sql
-- Colonne disponibili:
id, name, component_path, css_class, default_config, is_active, created_at

-- Colonne che NON esistono:
description, ui_schema, slug, version
```

## ğŸš€ WORKFLOW SVILUPPO

### Aggiungere Nuovo Modulo
1. **Crea cartella**: `modules/mio-modulo/`
2. **File necessari**: `mio-modulo.php`, `mio-modulo.css`, `mio-modulo.js`
3. **Registra modulo**: Inserisci in `modules_registry`
4. **Template modulo**:
```php
<?php
$moduleData = $renderer->getModuleData('mioModulo', $config);
?>
<div class="mio-modulo">
    <!-- Contenuto modulo -->
</div>
```

### Personalizzazione Colori
```css
/* In assets/css/core/variables.css */
:root {
  --primary-color: #TUO_COLORE;
  --secondary-color: #ALTRO_COLORE;
}
```

### Override per Pagina (Database)
```json
{
  "--primary-color": "#D81E05",
  "--hero-bg": "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
}
```

## ğŸ”§ COMANDI UTILI

### Setup Iniziale
1. **Avvia XAMPP** (Apache + MySQL)
2. **Setup database**: `http://localhost/sito_modulare/admin/test-setup.php`
3. **Test pagina**: `http://localhost/sito_modulare/index.php`

### File di Test
- **Versione semplice**: `index-simple.php` (senza database)
- **Debug database**: `debug.php`
- **Test setup**: `test.php`

### Build System
```bash
npm install
npm run dev        # Watch mode senza server
npm run serve      # Watch mode con BrowserSync
npm run build      # Build solo asset
npm run release    # Build completo per cloud deployment
```

**âš ï¸ IMPORTANTE**: NON eseguire build automatici durante lo sviluppo. 
Il build Ã¨ necessario SOLO:
- Su richiesta esplicita dell'utente
- Prima del deploy su cloud
- Per testare versione produzione

## ğŸ¯ OBIETTIVI PROGETTO
- **Sistema modulare** riutilizzabile
- **CSS Variables** per personalizzazioni
- **SSR** per performance e SEO
- **Responsive** design
- **Facile estensione** con nuovi moduli
- **AI-friendly** per generazione automatica pagine

## ğŸ“ NOTE IMPORTANTI
- **Path corretto**: `http://localhost/sito_modulare/`
- **Database**: MySQL su XAMPP
- **Status pagina**: Deve essere "published" per essere visibile
- **Moduli**: Ogni modulo ha PHP + CSS + JS nella stessa cartella
- **CSS Variables**: Sistema di personalizzazione principale
- **Build**: SOLO su richiesta esplicita, mai automatico durante sviluppo
- **Sviluppo**: Modifica file direttamente, usa `npm run dev` per live-reload

## ğŸš¨ PROBLEMI COMUNI
1. **"Pagina non trovata"**: Controlla status = 'published'
2. **Database vuoto**: Usa `admin/test-setup.php`
3. **Moduli mancanti**: Verifica `modules_registry`
4. **Path sbagliato**: Usa `http://localhost/sito_modulare/`
5. **"Undefined variable $renderer"**: Variabile passata automaticamente dal ModuleRenderer
6. **Percorsi moduli**: Devono essere relativi (es. `hero/hero.php` non `modules/hero/hero.php`)
7. **SQL LIMIT error**: LIMIT non puÃ² essere parametro preparato, usa concatenazione sicura

## ğŸ§© SVILUPPO MODULI

### Guida Completa
- **Documentazione**: `MODULE-DEVELOPMENT-GUIDE.md` (guida completa)
- **Regole**: `MODULE-RULES.md` (regole specifiche)
- **Template**: `MODULE-TEMPLATE.md` (template completo)
- **Checklist**: `MODULE-CHECKLIST.md` (checklist validazione)
- **Esempi**: `modules/README.md` (esempi pratici)

### Struttura Modulo Obbligatoria
```
modules/mio-modulo/
â”œâ”€â”€ mio-modulo.php          # Template PHP (OBBLIGATORIO)
â”œâ”€â”€ mio-modulo.css          # Stili CSS (OBBLIGATORIO)
â”œâ”€â”€ module.json             # Manifest modulo (OBBLIGATORIO)
â”œâ”€â”€ mio-modulo.js           # JavaScript (OPZIONALE)
â”œâ”€â”€ install.sql             # Setup database (OPZIONALE)
â””â”€â”€ README.md               # Documentazione (OPZIONALE)
```

### Regole CSS CRITICHE
- **MAI stili annidati** (`&:hover`, `&::before`)
- **SOLO CSS classico** esplicito
- **CSS Variables** obbligatorie
- **BEM methodology** per classi
- **Mobile-first** responsive

### Template PHP Standard
```php
<?php
$moduleData = $renderer->getModuleData('mioModulo', $config);
$title = $config['title'] ?? $moduleData['title'] ?? 'Default';
?>
<div class="mio-modulo mio-modulo--<?= htmlspecialchars($variant) ?>">
    <!-- Contenuto -->
</div>
```

### Manifest module.json
```json
{
  "name": "mio-modulo",
  "slug": "mio-modulo",
  "component_path": "mio-modulo/mio-modulo.php",
  "default_config": {},
  "ui_schema": {}
}
```

### Page Builder Integration
- **CSS Override** per disabilitare `position: fixed`
- **UI Schema** completo per configurazione
- **Drag & Drop** support
- **Real-time preview** funzionante

## ğŸ”„ PROSSIMI PASSI
1. **Test sistema** con `index.php`
2. **Setup database** con `admin/test-setup.php`
3. **Personalizza colori** con Theme Editor
4. **Aggiungi moduli** secondo necessitÃ 
5. **Deploy** su server produzione

## âš ï¸ CHECKLIST PRE-COMMIT

Prima di ogni commit, verifica:

### ğŸš¨ Codice Pulito
- [ ] âŒ Nessun CSS inline in HTML/PHP
- [ ] âŒ Nessun JavaScript inline in HTML/PHP
- [ ] âŒ Nessun valore hardcoded
- [ ] âŒ Nessuna query SQL diretta in template
- [ ] âœ… Separazione: `.php` + `.css` + `.js`
- [ ] âœ… CSS Variables per colori/spacing
- [ ] âœ… Prepared statements per database
- [ ] âœ… Sanitizzazione output (`htmlspecialchars()`)

### ğŸ“š Documentazione
- [ ] âŒ Nessun file `.md` duplicato
- [ ] âŒ Nessun file obsoleto (`FIX-*.md`, `QUICK-*.md`)
- [ ] âœ… File `.md` organizzati per categoria
- [ ] âœ… Riferimenti aggiornati in `README.md` e `.cursorrules`
- [ ] âœ… Link interni funzionanti
- [ ] âœ… Un solo file per argomento

### ğŸ§¹ Pulizia
- [ ] âœ… File temporanei eliminati
- [ ] âœ… Commenti debug rimossi
- [ ] âœ… Console.log() rimossi in produzione
- [ ] âœ… Codice formattato correttamente

## ğŸ“š DOCUMENTAZIONE ORGANIZZATA

### ğŸš¨ REGOLE GESTIONE DOCUMENTAZIONE

#### âœ… OBBLIGATORIO

1. **Organizzare file `.md` con cura**
   - âœ… Usa struttura gerarchica logica (`docs/`, `admin/docs/`, `modules/docs/`)
   - âœ… Nomenclatura chiara e descrittiva (`PAGE-BUILDER.md` non `PB.md`)
   - âœ… Posiziona in cartelle strategiche per categoria
   - âœ… Mantieni un solo `README.md` per cartella come indice

2. **Eliminare vecchi file non piÃ¹ utili**
   - âœ… **SEMPRE** elimina file obsoleti dopo consolidamento
   - âœ… **SEMPRE** elimina fix temporanei dopo risoluzione
   - âœ… **MAI** accumulare file `FIX-*.md` o `QUICK-*.md` indefinitamente
   - âœ… Mantieni max 1 file per argomento consolidato

3. **Modificare esistenti invece di crearne nuovi**
   - âœ… **PRIMA** cerca file esistente simile
   - âœ… **AGGIORNA** file esistente se possibile
   - âœ… **CONSOLIDA** informazioni duplicate in un unico file
   - âœ… **CREA nuovo** solo se argomento completamente diverso
   - âŒ **MAI** creare `FILE-v2.md`, `FILE-new.md`, `FILE-final.md`

4. **Aggiornare riferimenti**
   - âœ… **SEMPRE** aggiorna `README.md` quando sposti file
   - âœ… **SEMPRE** aggiorna `.cursorrules` quando cambi struttura
   - âœ… **SEMPRE** aggiorna link interni nei file `.md`
   - âœ… **VERIFICA** che tutti i link funzionino dopo modifiche

5. **Posizionamento strategico**
   - âœ… **Sistema generale** â†’ `docs/`
   - âœ… **Admin specifico** â†’ `admin/docs/`
   - âœ… **Moduli** â†’ `modules/docs/`
   - âœ… **Database** â†’ `database/docs/`
   - âŒ **MAI** file `.md` sparsi in root senza organizzazione

#### ğŸ“ Template Documentazione Standard

```markdown
# ğŸ¯ Titolo Chiaro e Descrittivo

## ğŸ¯ Panoramica
Breve descrizione del contenuto (2-3 frasi)

## ğŸ“‹ Contenuto
Organizzato in sezioni logiche con header H2/H3

## ğŸ§ª Esempi Pratici
Esempi concreti quando applicabile

## ğŸš¨ Troubleshooting
Problemi comuni e soluzioni

## ğŸ“š Riferimenti
Link a file correlati

---
**Titolo - Sistema Modulare Bologna Marathon** ğŸ¯
*Versione 1.0.0 - Data*
```

### ğŸ“ Struttura Documentazione

#### Sistema Generale (`docs/`)
- **`docs/README.md`** - Panoramica documentazione
- **`docs/BUILD-SYSTEM.md`** - Sistema build e deploy
- **`docs/LAYOUT-SYSTEM.md`** - Sistema layout responsive
- **`docs/THEME-SYSTEM-FINAL.md`** - Sistema temi dinamici

#### Admin (`admin/docs/`)
- **`admin/docs/PAGE-BUILDER.md`** - Guida completa Page Builder
- **`admin/docs/FIXES.md`** - Fix tecnici applicati
- **`admin/docs/TROUBLESHOOTING.md`** - Risoluzione problemi
- **`admin/page-builder.php`** - Page Builder principale
- **`admin/test-setup.php`** - Setup database

#### Moduli (`modules/docs/`)
- **`modules/docs/DEVELOPMENT-GUIDE.md`** - Guida sviluppo moduli
- **`modules/docs/TEMPLATES-SYSTEM.md`** - Sistema modelli globali
- **`modules/README.md`** - Esempi pratici moduli

#### Database (`database/docs/`)
- **`database/docs/SCHEMA-REFERENCE.md`** - Riferimento schema completo
- **`database/docs/MIGRATIONS.md`** - Guide migrazione database
- **`database/schema.sql`** - Schema database

## ğŸ¨ SISTEMA MODELLI MODULI GLOBALI
- **Modelli Condivisi**: Un'unica istanza master referenziata da piÃ¹ pagine
- **Modifica Globale**: Aggiorna master â†’ applica a tutte le pagine
- **Personalizzazione**: PossibilitÃ  di "staccare" e personalizzare per singola pagina
- **Interfaccia**: Integrata nel Page Builder con UI intuitiva
- **Database**: Colonne `is_template`, `template_name`, `template_instance_id`
- **Use Cases**: Menu, footer, newsletter form condivisi
- **Installazione**: `admin/install-templates.php`
- **Guida**: `MODULE-TEMPLATES-GUIDE.md`

## ğŸ¨ SISTEMA TEMI AGGIORNATO
- **Theme Editor**: Gestione completa temi dinamici
- **CSS Variables**: Sistema automatico di generazione
- **Override Sezioni**: Supporto per classi specifiche
- **Database**: Struttura compatibile con entrambe le versioni

## ğŸ§© REGOLE MODULI CONSOLIDATE
- **Struttura**: `modulo.php`, `modulo.css`, `module.json`
- **CSS**: SOLO CSS classico, MAI stili annidati
- **BEM**: Metodologia obbligatoria per classi
- **Responsive**: Mobile-first design
- **Database**: Prepared statements obbligatori
- **Sicurezza**: Sanitizzazione output obbligatoria
